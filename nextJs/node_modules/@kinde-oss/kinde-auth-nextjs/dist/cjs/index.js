"use strict";var e,t,n,r=require("react");!function(e){e.AUTHORIZATION_CODE="AUTHORIZATION_CODE",e.CLIENT_CREDENTIALS="CLIENT_CREDENTIALS",e.PKCE="PKCE"}(e||(e={})),function(e){e.s="string",e.b="boolean",e.i="number"}(t||(t={})),function(e){e.BROWSER="BROWSER",e.NODEJS="NODEJS"}(n||(n={})),"undefined"==typeof window?n.NODEJS:n.BROWSER;const o=process.env.KINDE_SITE_URL,a=process.env.NEXT_PUBLIC_KINDE_AUTH_API_PATH||process.env.KINDE_AUTH_API_PATH||"/api/auth",i=process.env.KINDE_POST_LOGIN_REDIRECT_URL||process.env.KINDE_POST_LOGIN_URL_REDIRECT_URL,s=process.env.KINDE_POST_LOGOUT_REDIRECT_URL,l=process.env.KINDE_ISSUER_URL,c=process.env.KINDE_CLIENT_ID,g=process.env.KINDE_CLIENT_SECRET,u=process.env.KINDE_AUDIENCE,d={apiPath:a,initialState:{accessToken:null,idToken:null,isAuthenticated:!1,isLoading:!0,organization:null,permissions:[],user:null,userOrganiaztions:[],getAccessToken:()=>null,getBooleanFlag:()=>null,getClaim:()=>null,getFlag:()=>null,getIdToken:()=>null,getIntegerFlag:()=>null,getOrganization:()=>null,getPermission:()=>null,getPermissions:()=>[],getStringFlag:()=>null,getToken:()=>null,getUser:()=>null,getUserOrganizations:()=>null},SESSION_PREFIX:"pkce-verifier",redirectURL:o,postLoginRedirectURL:i,issuerURL:l,clientID:c,clientSecret:g,postLogoutRedirectURL:s,audience:u,responseType:"code",scope:"openid profile email offline",codeChallengeMethod:"S256",redirectRoutes:{callback:`${a}/kinde_callback`},issuerRoutes:{logout:"/logout",login:"/oauth2/auth",register:"/oauth2/auth",token:"/oauth2/token",profile:"/oauth2/v2/user_profile"},clientOptions:{audience:u||"",authDomain:l||"",clientId:c||"",clientSecret:g||"",logoutRedirectURL:s||"",redirectURL:`${o}/api/auth/kinde_callback`,frameworkVersion:"2.0.4",framework:"Next.js"},grantType:e.AUTHORIZATION_CODE},p={s:"string",i:"integer",b:"boolean"},h=r.createContext({...d.initialState});function f(e){this.message=e}f.prototype=new Error,f.prototype.name="InvalidCharacterError";var T="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new f("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,o=0,a=0,i="";r=t.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?i+=String.fromCharCode(255&n>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};function k(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(T(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return T(t)}}function E(e){this.message=e}function _(e,t){if("string"!=typeof e)throw new E("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(k(e.split(".")[n]))}catch(e){throw new E("Invalid token specified: "+e.message)}}E.prototype=new Error,E.prototype.name="InvalidTokenError";function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},I.apply(this,arguments)}exports.CreateOrgLink=function({children:e,orgName:t,...n}){return r.createElement("a",I({href:`${d.apiPath}/create_org${t?`?org_name=${t}`:""}`},n),e)},exports.KindeProvider=({children:e})=>{const[t,n]=r.useState({...d.initialState}),o=`${d.apiPath}/setup`,a=r.useCallback((async()=>{try{const e=await(async e=>{let t;try{t=await fetch(e)}catch{throw new Error("Failed to fetch token")}if(t.ok)return await t.json();if(401===t.status)throw new Error("Failed to fetch token")})(o);if(null==e)return;const{accessToken:t,accessTokenEncoded:r,featureFlags:a,idToken:i,organization:s,permissions:l,user:c,userOrganizations:g}=e,u=()=>t,d=()=>r,h=()=>i,f=()=>l,T=()=>s,k=()=>c,E=()=>g,_=(t,n="access_token")=>{const r="access_token"===n?e.accessToken:e.idToken;return r?{name:t,value:r[t]}:null},I=(e,t,n)=>{const r=a,o=r&&r[e]?r[e]:{};if(o=={}&&null==t)throw Error(`Flag ${e} was not found, and no default value has been provided`);if(n&&o.t&&n!==o.t)throw Error(`Flag ${e} is of type ${p[o.t]} - requested type ${p[n]}`);return{code:e,type:p[o.t||n],value:null==o.v?t:o.v,is_default:null==o.v,defaultValue:t}},m=(e,t)=>{try{return I(e,t,"b").value}catch(e){console.error(e)}},v=(e,t)=>{try{return I(e,t,"s").value}catch(e){console.error(e)}},O=(e,t)=>{try{return I(e,t,"i").value}catch(e){console.error(e)}},R=e=>({isGranted:l.permissions.some((t=>t===e)),orgCode:s.orgCode});n((e=>({...e,accessToken:t,idToken:i,isLoading:!1,organization:s,permissions:l,user:c,userOrganizations:g,getAccessToken:u,getBooleanFlag:m,getClaim:_,getFlag:I,getIdToken:h,getIntegerFlag:O,getOrganization:T,getPermission:R,getPermissions:f,getStringFlag:v,getToken:d,getUser:k,getUserOrganizations:E})))}catch(e){n((t=>({...t,isLoading:!1,error:e})))}}),[o]);r.useEffect((()=>{t.user||(async()=>{await a(),n((e=>({...e,isLoading:!1})))})()}),[t.user]);const{user:i,accessToken:s,idToken:l,getAccessToken:c,getToken:g,getClaim:u,getFlag:f,getIdToken:T,getBooleanFlag:k,getStringFlag:E,getIntegerFlag:_,getOrganization:I,getPermission:m,getPermissions:v,getUser:O,getUserOrganizations:R,permissions:L,organization:w,userOrganizations:S,error:C,isLoading:U}=t;return r.createElement(h.Provider,{value:{user:i,error:C,accessToken:s,idToken:l,getAccessToken:c,getToken:g,getClaim:u,getFlag:f,getIdToken:T,getBooleanFlag:k,getStringFlag:E,getIntegerFlag:_,getOrganization:I,getPermission:m,getPermissions:v,getUser:O,getUserOrganizations:R,permissions:L,organization:w,userOrganizations:S,isLoading:U,isAuthenticated:!!i}},e)},exports.LoginLink=function({children:e,postLoginRedirectURL:t,orgCode:n,authUrlParams:o,...a}){let i=new URLSearchParams,s={};null!=n&&(s.org_code=n),null!=t&&(s.post_login_redirect_url=t),s={...o,...s};for(const e in s)i.append(e,s[e]);return r.createElement("a",I({href:`${d.apiPath}/login${i?`?${i.toString()}`:""}`},a),e)},exports.LogoutLink=function({children:e,...t}){return r.createElement("a",I({href:`${d.apiPath}/logout`},t),e)},exports.RegisterLink=function({children:e,orgCode:t,postLoginRedirectURL:n,authUrlParams:o,...a}){let i=new URLSearchParams,s={};null!=t&&(s.org_code=t),null!=n&&(s.post_login_redirect_url=n),s={...o,...s};for(const e in s)i.append(e,s[e]);return r.createElement("a",I({href:`${d.apiPath}/register${i?`?${i.toString()}`:""}`},a),e)},exports.isTokenValid=e=>{const t=e&&e.access_token||e;if(!t)return!1;const n=_(t,{header:!0}),r=_(t);let o=!0;return d.audience&&(o=r.aud&&r.aud.includes(d.audience)),!!(r.iss==d.issuerURL&&"RS256"==n.alg&&r.exp>Math.floor(Date.now()/1e3)&&o)},exports.useKindeAuth=()=>r.useContext(h),exports.useKindeBrowserClient=()=>{const[e,t]=r.useState({accessToken:null,accessTokenEncoded:null,error:null,featureFlags:[],idToken:null,isAuthenticated:!1,isLoading:!0,organization:null,permissions:[],user:null,userOrganizations:[]});r.useEffect((()=>{(async()=>{const e=await fetch("/api/auth/setup"),n=await e.json();200==e.status&&t({...n});const r=n.error;t((e=>({...e,isLoading:!1,error:r})))})()}),[]);const n=(t,n,r)=>{const o=e.featureFlags||[],a=o&&o[t]?o[t]:{};if(a=={}&&null==n)throw Error(`Flag ${t} was not found, and no default value has been provided`);if(r&&a.t&&r!==a.t)throw Error(`Flag ${t} is of type ${p[a.t]} - requested type ${p[r]}`);return{code:t,type:p[a.t||r],value:null==a.v?n:a.v,is_default:null==a.v}};return{...e,isAuthenticated:!!e.user,getPermission:t=>({isGranted:e.permissions.some((e=>e===t)),orgCode:e.organization}),getBooleanFlag:(e,t)=>{try{return n(e,t,"b").value}catch(e){console.error(e)}},getIntegerFlag:(e,t)=>{try{return n(e,t,"i").value}catch(e){console.error(e)}},getFlag:n,getStringFlag:(e,t)=>{try{return n(e,t,"s").value}catch(e){console.error(e)}},getClaim:(t,n="access_token")=>{const r="access_token"===n?e.accessToken:e.idToken;return r?{name:t,value:r[t]}:null},getAccessToken:()=>e.accessToken,getToken:()=>e.accessTokenEncoded,getIdToken:()=>e.idToken,getOrganization:()=>e.organization,getPermissions:()=>e.permissions,getUserOrganizations:()=>e.userOrganizations}};
//# sourceMappingURL=index.js.map
