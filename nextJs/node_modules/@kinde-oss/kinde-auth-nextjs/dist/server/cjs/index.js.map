{"version":3,"file":"index.js","sources":["../../../src/utils/isAppRouter.js","../../../src/session/sessionManager.js","../../../src/session/getAccessToken.js","../../../src/config/index.js","../../../src/utils/version.js","../../../src/session/kindeServerClient.js","../../../src/session/getFlag.js","../../../src/session/getBooleanFlag.js","../../../src/session/getIdToken.js","../../../src/session/getIntegerFlag.js","../../../src/session/getOrganization.js","../../../src/session/getPermission.js","../../../src/session/getPermissions.js","../../../src/session/getStringFlag.js","../../../src/session/getUser.js","../../../src/session/getUserOrganizations.js","../../../src/session/isAuthenticated.js","../../../src/routerClients/AppRouterClient.js","../../../src/routerClients/PagesRouterClient.js","../../../src/handlers/auth.js","../../../src/handlers/createOrg.js","../../../src/handlers/register.js","../../../src/handlers/setup.js","../../../src/handlers/login.js","../../../src/handlers/logout.js","../../../src/handlers/callback.js","../../../src/components/CreateOrgLink.js","../../../src/components/LoginLink.js","../../../src/components/LogoutLink.js","../../../src/components/RegisterLink.js","../../../src/api-client.js","../../../src/utils/pageRouter/isTokenValid.js","../../../src/session/index.js"],"sourcesContent":["export const isAppRouter = (req) => {\n  return req instanceof Request;\n};\n","import {isAppRouter} from '../utils/isAppRouter';\nimport {cookies} from 'next/headers';\n\nvar cookie = require('cookie');\n\n/**\n *\n * @param {Request} [req]\n * @param {Response} [res]\n * @returns\n */\nexport const sessionManager = (req, res) => {\n  if (!req) return appRouterSessionManager(cookies());\n  return isAppRouter(req)\n    ? appRouterSessionManager(cookies())\n    : pageRouterSessionManager(req, res);\n};\n\nexport const appRouterSessionManager = (cookieStore) => ({\n  /**\n   *\n   * @param {string} itemKey\n   * @returns {Promise<string | undefined>}\n   */\n  getSessionItem: (itemKey) => {\n    const item = cookieStore.get(itemKey);\n    if (item) {\n      try {\n        const jsonValue = JSON.parse(item.value);\n        if (typeof jsonValue === 'object') {\n          return jsonValue;\n        }\n        return item.value;\n      } catch (error) {\n        return item.value;\n      }\n    }\n    return undefined;\n  },\n  /**\n   *\n   * @param {string} itemKey\n   * @param {string | object} itemValue\n   * @returns {Promise<void>}\n   */\n  setSessionItem: (itemKey, itemValue) =>\n    cookieStore.set(\n      itemKey,\n      typeof itemValue === 'object' ? JSON.stringify(itemValue) : itemValue\n    ),\n  /**\n   *\n   * @param {string} itemKey\n   * @returns {Promise<void>}\n   */\n  removeSessionItem: (itemKey) => cookieStore.delete(itemKey),\n  destroySession: () => {\n    [\n      'id_token_payload',\n      'id_token',\n      'access_token_payload',\n      'access_token',\n      'user',\n      'refresh_token'\n    ].forEach((name) => cookieStore.delete(name));\n  }\n});\n\nexport const pageRouterSessionManager = (req, res) => ({\n  /**\n   *\n   * @param {string} itemKey\n   * @returns {Promise<string | undefined>}\n   */\n  getSessionItem: (itemKey) => {\n    const itemValue = req.cookies[itemKey];\n    if (itemValue) {\n      try {\n        const jsonValue = JSON.parse(itemValue);\n        if (typeof jsonValue === 'object') {\n          return jsonValue;\n        }\n        return itemValue;\n      } catch (error) {\n        return itemValue;\n      }\n    }\n    return undefined;\n  },\n  /**\n   *\n   * @param {string} itemKey -\n   * @param {string | object} itemValue\n   * @returns {Promise<void>}\n   */\n  setSessionItem: (itemKey, itemValue) => {\n    let cookies = res.getHeader('Set-Cookie') || [];\n\n    if (!Array.isArray(cookies)) {\n      cookies = [cookies];\n    }\n\n    res.setHeader('Set-Cookie', [\n      ...cookies.filter((cookie) => !cookie.startsWith(`${itemKey}=`)),\n      cookie.serialize(\n        itemKey,\n        typeof itemValue === 'object' ? JSON.stringify(itemValue) : itemValue,\n        {path: '/'}\n      )\n    ]);\n  },\n  /**\n   *\n   * @param {string} itemKey\n   * @returns {Promise<void>}\n   */\n  removeSessionItem: (itemKey) => {\n    res.setHeader(\n      'Set-Cookie',\n      cookie.serialize(itemKey, '', {path: '/', maxAge: -1})\n    );\n  },\n  destroySession: () => {\n    res.setHeader(\n      'Set-Cookie',\n      [\n        'id_token_payload',\n        'id_token',\n        'access_token_payload',\n        'access_token',\n        'user',\n        'refresh_token'\n      ].map((name) => cookie.serialize(name, '', {path: '/', maxAge: -1}))\n    );\n  }\n});\n","import {sessionManager} from './sessionManager';\n\n/**\n * @callback getAccessToken\n * @returns {Promise<import('../../types.js').KindeAccessToken | undefined>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n *\n * @returns {getAccessToken}\n */\n// @ts-ignore\nexport const getAccessTokenFactory = (req, res) => async () => {\n  return await sessionManager(req, res).getSessionItem('access_token_payload');\n};\n","import {GrantType} from '@kinde-oss/kinde-typescript-sdk';\nimport {version} from '../utils/version';\n\n/**\n * @type {import('../../types').KindeState}\n */\nconst initialState = {\n  accessToken: null,\n  idToken: null,\n  isAuthenticated: false,\n  isLoading: true,\n  organization: null,\n  permissions: [],\n  user: null,\n  userOrganiaztions: [],\n  getAccessToken: () => null,\n  getBooleanFlag: () => null,\n  getClaim: () => null,\n  getFlag: () => null,\n  getIdToken: () => null,\n  getIntegerFlag: () => null,\n  getOrganization: () => null,\n  getPermission: () => null,\n  getPermissions: () => [],\n  getStringFlag: () => null,\n  getToken: () => null,\n  getUser: () => null,\n  getUserOrganizations: () => null\n};\n\nconst SESSION_PREFIX = 'pkce-verifier';\n\nconst KINDE_SITE_URL = process.env.KINDE_SITE_URL;\n\n// We need to use NEXT_PUBLIC for frontend vars\nconst KINDE_AUTH_API_PATH =\n  process.env.NEXT_PUBLIC_KINDE_AUTH_API_PATH ||\n  process.env.KINDE_AUTH_API_PATH ||\n  '/api/auth';\n\nconst KINDE_POST_LOGIN_REDIRECT_URL =\n  process.env.KINDE_POST_LOGIN_REDIRECT_URL ||\n  process.env.KINDE_POST_LOGIN_URL_REDIRECT_URL;\nconst KINDE_POST_LOGOUT_REDIRECT_URL =\n  process.env.KINDE_POST_LOGOUT_REDIRECT_URL;\n\nconst KINDE_ISSUER_URL = process.env.KINDE_ISSUER_URL;\nconst KINDE_CLIENT_ID = process.env.KINDE_CLIENT_ID;\nconst KINDE_CLIENT_SECRET = process.env.KINDE_CLIENT_SECRET;\nconst KINDE_AUDIENCE = process.env.KINDE_AUDIENCE;\n\nexport const config = {\n  apiPath: KINDE_AUTH_API_PATH,\n  initialState,\n  SESSION_PREFIX,\n  redirectURL: KINDE_SITE_URL,\n  postLoginRedirectURL: KINDE_POST_LOGIN_REDIRECT_URL,\n  issuerURL: KINDE_ISSUER_URL,\n  clientID: KINDE_CLIENT_ID,\n  clientSecret: KINDE_CLIENT_SECRET,\n  postLogoutRedirectURL: KINDE_POST_LOGOUT_REDIRECT_URL,\n  audience: KINDE_AUDIENCE,\n  responseType: 'code',\n  scope: 'openid profile email offline',\n  codeChallengeMethod: 'S256',\n  redirectRoutes: {\n    callback: `${KINDE_AUTH_API_PATH}/kinde_callback`\n  },\n  issuerRoutes: {\n    logout: '/logout',\n    login: '/oauth2/auth',\n    register: '/oauth2/auth',\n    token: '/oauth2/token',\n    profile: '/oauth2/v2/user_profile'\n  },\n  clientOptions: {\n    audience: KINDE_AUDIENCE || '',\n    authDomain: KINDE_ISSUER_URL || '',\n    clientId: KINDE_CLIENT_ID || '',\n    clientSecret: KINDE_CLIENT_SECRET || '',\n    logoutRedirectURL: KINDE_POST_LOGOUT_REDIRECT_URL || '',\n    redirectURL: `${KINDE_SITE_URL}/api/auth/kinde_callback`,\n    frameworkVersion: version,\n    framework: 'Next.js'\n  },\n  grantType: GrantType.AUTHORIZATION_CODE\n};\n","// Generated by genversion.\nexport const version = '2.0.4'\n","import {createKindeServerClient} from '@kinde-oss/kinde-typescript-sdk';\nimport {config} from '../config/index';\n\nexport const kindeClient = createKindeServerClient(\n  config.grantType,\n  config.clientOptions\n);\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getFlag\n * @param {string} code\n * @param {boolean | number | string} defaultValue\n * @param {import('../../types').KindeFlagTypeCode} flagType\n * @returns {Promise<import('../../types').KindeFlag | {value: boolean | number | string}>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getFlag}\n */\nexport const getFlagFactory =\n  (req, res) => async (code, defaultValue, flagType) => {\n    try {\n      const flag = await kindeClient.getFlag(\n        sessionManager(req, res),\n        code,\n        defaultValue,\n        flagType\n      );\n\n      return flag;\n    } catch (error) {\n      //@ts-ignore\n      if (error.message.includes('no default value has been provided')) {\n        throw error;\n      }\n      return {value: defaultValue};\n    }\n  };\n","import {getFlagFactory} from './getFlag';\n\n/**\n * @callback getBooleanFlag\n * @param {string} code\n * @param {boolean} defaultValue\n * @returns {Promise<boolean | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getBooleanFlag}\n */\nexport const getBooleanFlagFactory =\n  (req, res) => async (code, defaultValue) => {\n    try {\n      const flag = await getFlagFactory(req, res)(code, defaultValue, 'b');\n      return flag.value;\n    } catch (err) {\n      console.error(err);\n      return null;\n    }\n  };\n","import {sessionManager} from './sessionManager';\n\n/**\n * @callback getIdToken\n * @returns {Promise<import('../../types').KindeIdToken>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getIdToken}\n */\n\n// @ts-ignore\nexport const getIdTokenFactory = (req, res) => async () => {\n  return await sessionManager(req, res).getSessionItem('id_token_payload');\n};\n","import {getFlagFactory} from './getFlag';\n\n/**\n * @callback getIntegerFlag\n * @param {string} code\n * @param {number} defaultValue\n * @returns {Promise<number | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getIntegerFlag}\n */\nexport const getIntegerFlagFactory =\n  (req, res) => async (code, defaultValue) => {\n    try {\n      const flag = await getFlagFactory(req, res)(code, defaultValue, 'i');\n      return flag.value;\n    } catch (err) {\n      console.error(err);\n      return null;\n    }\n  };\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getOrganization\n * @returns {Promise<import('../../types').KindeOrganization | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getOrganization}\n */\nexport const getOrganizationFactory = (req, res) => async () => {\n  try {\n    const organization = await kindeClient.getOrganization(\n      sessionManager(req, res)\n    );\n    return organization;\n  } catch (error) {\n    return null;\n  }\n};\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getPermission\n *  @param {string} name\n * @returns {Promise<import('../../types').KindePermission | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getPermission}\n */\nexport const getPermissionFactory = (req, res) => async (name) => {\n  try {\n    const permission = await kindeClient.getPermission(\n      sessionManager(req, res),\n      name\n    );\n    return permission;\n  } catch (error) {\n    return null;\n  }\n};\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getPermissions\n * @returns {Promise<import('../../types').KindePermissions | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getPermissions}\n */\nexport const getPermissionsFactory = (req, res) => async () => {\n  try {\n    const permissions = await kindeClient.getPermissions(\n      sessionManager(req, res)\n    );\n    return permissions;\n  } catch (error) {\n    return null;\n  }\n};\n","import {getFlagFactory} from './getFlag';\n\n/**\n * @callback getStringFlag\n * @param {string} code\n * @param {string} defaultValue\n * @returns {Promise<string | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getStringFlag}\n */\nexport const getStringFlagFactory =\n  (req, res) => async (code, defaultValue) => {\n    try {\n      const flag = await getFlagFactory(req, res)(code, defaultValue, 's');\n      return flag.value;\n    } catch (err) {\n      console.error(err);\n      return null;\n    }\n  };\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getUser\n * @returns {Promise<import('../../types').KindeUser | null>}\n */\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getUser}\n */\nexport const getUserFactory = (req, res) => async () => {\n  try {\n    // @ts-ignore\n    const user = await kindeClient.getUser(sessionManager(req, res));\n    return user;\n  } catch (error) {\n    return null;\n  }\n};\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getUserOrganizations\n * @returns {Promise<import('../../types').KindeOrganizations | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getUserOrganizations}\n */\nexport const getUserOrganizationsFactory = (req, res) => async () => {\n  try {\n    const userOrgs = await kindeClient.getUserOrganizations(\n      sessionManager(req, res)\n    );\n    return userOrgs;\n  } catch (error) {\n    return null;\n  }\n};\n","import {getUserFactory} from './getUser';\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {() => Promise<boolean>}\n */\nexport const isAuthenticatedFactory = (req, res) => async () => {\n  const user = await getUserFactory(req, res)();\n  return Boolean(user);\n};\n","import {createKindeServerClient} from '@kinde-oss/kinde-typescript-sdk';\nimport {cookies} from 'next/headers';\nimport {redirect} from 'next/navigation';\nimport {NextResponse} from 'next/server';\nimport {config} from '../config/index';\nimport {appRouterSessionManager} from '../session/sessionManager';\n\nexport default class AppRouterClient {\n  constructor(req, res) {\n    this.kindeClient = createKindeServerClient(\n      config.grantType,\n      config.clientOptions\n    );\n    this.url = new URL(req.url);\n    this.sessionManager = appRouterSessionManager(cookies());\n    this.req = req;\n    this.searchParams = req.nextUrl.searchParams;\n  }\n\n  redirect(url) {\n    return redirect(url);\n  }\n\n  getUrl() {\n    return this.url;\n  }\n\n  json(data, status) {\n    return NextResponse.json(data, status);\n  }\n\n  error() {\n    return NextResponse.error;\n  }\n\n  getSearchParam(key) {\n    return this.req.nextUrl.searchParams.get(key);\n  }\n}\n","import {createKindeServerClient} from '@kinde-oss/kinde-typescript-sdk';\nimport {config} from '../config/index';\nimport {sessionManager} from '../session/sessionManager';\n\nexport default class PagesRouterClient {\n  constructor(req, res) {\n    this.kindeClient = createKindeServerClient(\n      config.grantType,\n      config.clientOptions\n    );\n    this.url = new URL(config.redirectURL + req.url);\n    this.res = res;\n    this.req = req;\n    this.searchParams = this.url.searchParams;\n    this.sessionManager = sessionManager(req, res);\n  }\n\n  redirect(url) {\n    return this.res.redirect(url.href ? url.href : url);\n  }\n\n  getUrl() {\n    return this.url;\n  }\n\n  json(data, status = 200) {\n    return this.res.status(status).json(data);\n  }\n\n  getSearchParam(key) {\n    return this.url.searchParams.get(key);\n  }\n}\n","import {isAppRouter} from '../utils/isAppRouter';\nimport {callback} from './callback';\nimport {createOrg} from './createOrg';\nimport {login} from './login';\nimport {logout} from './logout';\nimport {setup} from './setup';\nimport {register} from './register';\nimport AppRouterClient from '../routerClients/AppRouterClient';\nimport PagesRouterClient from '../routerClients/PagesRouterClient';\n\nconst routeMap = {\n  create_org: createOrg,\n  register,\n  setup,\n  login,\n  logout,\n  kinde_callback: callback\n};\n\nconst getRoute = (endpoint) => {\n  return routeMap[endpoint];\n};\n/**\n * @param {object} [request]\n * @param {string} [endpoint]\n */\nexport default (request, endpoint) => {\n  // For backwards compatibility in app router\n  if (typeof request == 'object' && typeof endpoint == 'string') {\n    return appRouterHandler(request, {params: {kindeAuth: endpoint}});\n  }\n  /**\n   *\n   * @param {Request} [req]\n   * @param {Response} [res]\n   * @returns {Response}\n   */\n  return async function handler(req, res) {\n    return isAppRouter(req)\n      ? appRouterHandler(req, res)\n      : pagesRouterHandler(req, res);\n  };\n};\n\nconst appRouterHandler = async (req, res) => {\n  const {params} = res;\n  let endpoint = params.kindeAuth;\n  endpoint = Array.isArray(endpoint) ? endpoint[0] : endpoint;\n  const route = getRoute(endpoint);\n\n  return route\n    ? await route(new AppRouterClient(req, res))\n    : new Response('This page could not be found.', {status: 404});\n};\n\nconst pagesRouterHandler = async (req, res) => {\n  let {\n    query: {kindeAuth: endpoint}\n  } = req;\n  endpoint = Array.isArray(endpoint) ? endpoint[0] : endpoint;\n  const route = getRoute(endpoint);\n  return route\n    ? await route(new PagesRouterClient(req, res))\n    : res.status(404).end();\n};\n","export const createOrg = async (routerClient) => {\n  const org_name = routerClient.getSearchParam('org_name');\n  const options = {\n    org_name,\n    is_create_org: true\n  };\n\n  const authUrl = await routerClient.kindeClient.createOrg(\n    routerClient.sessionManager,\n    options\n  );\n\n  routerClient.redirect(authUrl);\n};\n","export const register = async (routerClient) => {\n  const authUrl = await routerClient.kindeClient.register(\n    routerClient.sessionManager,\n    {\n      authUrlParams: Object.fromEntries(routerClient.searchParams)\n    }\n  );\n\n  const postLoginRedirectURL = routerClient.getSearchParam(\n    'post_login_redirect_url'\n  );\n\n  if (postLoginRedirectURL) {\n    await routerClient.sessionManager.setSessionItem(\n      'post_login_redirect_url',\n      postLoginRedirectURL\n    );\n  }\n\n  routerClient.redirect(authUrl);\n};\n","export const setup = async (routerClient) => {\n  const user = await routerClient.sessionManager.getSessionItem('user');\n  if (user) {\n    const accessToken = await routerClient.sessionManager.getSessionItem(\n      'access_token_payload'\n    );\n\n    const idToken = await routerClient.sessionManager.getSessionItem(\n      'id_token_payload'\n    );\n\n    const accessTokenEncoded = await routerClient.sessionManager.getSessionItem(\n      'access_token'\n    );\n\n    const permissions = await routerClient.kindeClient.getClaimValue(\n      routerClient.sessionManager,\n      'permissions'\n    );\n\n    const organization = await routerClient.kindeClient.getClaimValue(\n      routerClient.sessionManager,\n      'org_code'\n    );\n\n    const featureFlags = await routerClient.kindeClient.getClaimValue(\n      routerClient.sessionManager,\n      'feature_flags'\n    );\n\n    const userOrganizations = await routerClient.kindeClient.getClaimValue(\n      routerClient.sessionManager,\n      'org_codes',\n      'id_token'\n    );\n\n    return routerClient.json({\n      accessToken,\n      accessTokenEncoded,\n      idToken,\n      user,\n      permissions: {\n        permissions,\n        orgCode: organization\n      },\n      organization,\n      featureFlags,\n      userOrganizations\n    });\n  } else {\n    return routerClient.json({error: 'Log in with Kinde'}, {status: 401});\n  }\n};\n","export const login = async (routerClient) => {\n  const authUrl = await routerClient.kindeClient.login(\n    routerClient.sessionManager,\n    {\n      authUrlParams: Object.fromEntries(routerClient.searchParams)\n    }\n  );\n\n  const postLoginRedirectURL = routerClient.getSearchParam(\n    'post_login_redirect_url'\n  );\n\n  if (postLoginRedirectURL) {\n    await routerClient.sessionManager.setSessionItem(\n      'post_login_redirect_url',\n      postLoginRedirectURL\n    );\n  }\n\n  routerClient.redirect(authUrl);\n};\n","export const logout = async (routerClient) => {\n  const authUrl = await routerClient.kindeClient.logout(\n    routerClient.sessionManager\n  );\n\n  routerClient.redirect(authUrl);\n};\n","import {config} from '../config/index';\n\nexport const callback = async (routerClient) => {\n  const postLoginRedirectURLFromMemory =\n    await routerClient.sessionManager.getSessionItem('post_login_redirect_url');\n\n  if (postLoginRedirectURLFromMemory) {\n    await routerClient.sessionManager.removeSessionItem(\n      'post_login_redirect_url'\n    );\n  }\n\n  const postLoginRedirectURL = postLoginRedirectURLFromMemory\n    ? postLoginRedirectURLFromMemory\n    : config.postLoginRedirectURL;\n\n  await routerClient.kindeClient.handleRedirectToApp(\n    routerClient.sessionManager,\n    routerClient.getUrl()\n  );\n\n  routerClient.redirect(postLoginRedirectURL);\n};\n","import React from 'react';\n\nimport {config} from '../config/index';\n/**\n * @typedef {Object} PropsType\n * @prop {React.ReactNode} children\n * @prop {string} [orgName]\n *\n * @typedef {PropsType & React.AnchorHTMLAttributes<HTMLAnchorElement>} Props\n */\n\n/**\n * @param {Props} props\n */\nexport function CreateOrgLink({children, orgName, ...props}) {\n  return (\n    <a\n      href={`${config.apiPath}/create_org${\n        orgName ? `?org_name=${orgName}` : ''\n      }`}\n      {...props}\n    >\n      {children}\n    </a>\n  );\n}\n","import React from 'react';\nimport {config} from '../config/index';\n\n/**\n * @typedef {Object} PropsType\n * @prop {React.ReactNode} children\n * @prop {string} [orgCode]\n * @prop {string} [postLoginRedirectURL]\n * @prop {Object.<string, string>} [authUrlParams]\n *\n * @typedef {PropsType & React.AnchorHTMLAttributes<HTMLAnchorElement>} Props\n */\n\n/**\n * @param {Props} props\n */\nexport function LoginLink({\n  children,\n  postLoginRedirectURL,\n  orgCode,\n  authUrlParams,\n  ...props\n}) {\n  let params = new URLSearchParams();\n  let paramsObj = {};\n  if (orgCode != null) paramsObj.org_code = orgCode;\n  if (postLoginRedirectURL != null)\n    paramsObj.post_login_redirect_url = postLoginRedirectURL;\n\n  paramsObj = {...authUrlParams, ...paramsObj};\n\n  for (const key in paramsObj) params.append(key, paramsObj[key]);\n\n  return (\n    <a\n      href={`${config.apiPath}/login${params ? `?${params.toString()}` : ''}`}\n      {...props}\n    >\n      {children}\n    </a>\n  );\n}\n","import React from 'react';\n\nimport {config} from '../config/index';\n/**\n * @typedef {Object} PropsType\n * @prop {React.ReactNode} children\n *\n * @typedef {PropsType & React.AnchorHTMLAttributes<HTMLAnchorElement>} Props\n */\n\n/**\n * @param {Props} props\n */\nexport function LogoutLink({children, ...props}) {\n  return (\n    <a href={`${config.apiPath}/logout`} {...props}>\n      {children}\n    </a>\n  );\n}\n","import React from 'react';\nimport {config} from '../config/index';\n\n/**\n * @typedef {Object} PropsType\n * @prop {React.ReactNode} children\n * @prop {string} [orgCode]\n * @prop {string} [postLoginRedirectURL]\n * @prop {Object.<string, string>} [authUrlParams]\n *\n * @typedef {PropsType & React.AnchorHTMLAttributes<HTMLAnchorElement>} Props\n */\n\n/**\n * @param {Props} props\n */\n\nexport function RegisterLink({\n  children,\n  orgCode,\n  postLoginRedirectURL,\n  authUrlParams,\n  ...props\n}) {\n  let params = new URLSearchParams();\n  let paramsObj = {};\n  if (orgCode != null) paramsObj.org_code = orgCode;\n  if (postLoginRedirectURL != null)\n    paramsObj.post_login_redirect_url = postLoginRedirectURL;\n\n  paramsObj = {...authUrlParams, ...paramsObj};\n\n  for (const key in paramsObj) params.append(key, paramsObj[key]);\n  return (\n    <a\n      href={`${config.apiPath}/register${\n        params ? `?${params.toString()}` : ''\n      }`}\n      {...props}\n    >\n      {children}\n    </a>\n  );\n}\n","import {\n  APIsApi,\n  ApplicationsApi,\n  BusinessApi,\n  CallbacksApi,\n  Configuration,\n  ConnectedAppsApi,\n  EnvironmentsApi,\n  FeatureFlagsApi,\n  IndustriesApi,\n  OAuthApi,\n  OrganizationsApi,\n  PermissionsApi,\n  RolesApi,\n  SubscribersApi,\n  TimezonesApi,\n  UsersApi\n} from '@kinde-oss/kinde-typescript-sdk';\nimport {config} from './config/index';\nimport {sessionManager} from './session/sessionManager';\nimport {isTokenValid} from './utils/pageRouter/isTokenValid';\n\n/**\n * Create the Kinde Management API client\n * @param {Request | NextApiRequest} [req] - optional request (required when used with pages router)\n * @param {Response | NextApiResponse} [res] - optional response (required when used with pages router)\n */\nexport const createKindeManagementAPIClient = async (req, res) => {\n  let apiToken = null;\n\n  const store = sessionManager(req, res);\n  const tokenFromCookie = store.getSessionItem('kinde_api_access_token');\n\n  if (isTokenValid(tokenFromCookie)) {\n    apiToken = tokenFromCookie;\n  } else {\n    const response = await fetch(`${config.issuerURL}/oauth2/token`, {\n      method: 'POST',\n      headers: {\n        'content-type': 'application/x-www-form-urlencoded'\n      },\n      body: new URLSearchParams({\n        grant_type: 'client_credentials',\n        client_id: config.clientID,\n        client_secret: config.clientSecret,\n        audience: config.audience\n      })\n    });\n    apiToken = (await response.json()).access_token;\n    try {\n      store.setSessionItem('kinde_api_access_token', apiToken);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  const cfg = new Configuration({\n    basePath: config.issuerURL,\n    accessToken: apiToken,\n    headers: {Accept: 'application/json'}\n  });\n\n  const usersApi = new UsersApi(cfg);\n  const oauthApi = new OAuthApi(cfg);\n  const subscribersApi = new SubscribersApi(cfg);\n  const organizationsApi = new OrganizationsApi(cfg);\n  const connectedAppsApi = new ConnectedAppsApi(cfg);\n  const featureFlagsApi = new FeatureFlagsApi(cfg);\n  const environmentsApi = new EnvironmentsApi(cfg);\n  const permissionsApi = new PermissionsApi(cfg);\n  const rolesApi = new RolesApi(cfg);\n  const businessApi = new BusinessApi(cfg);\n  const industriesApi = new IndustriesApi(cfg);\n  const timezonesApi = new TimezonesApi(cfg);\n  const applicationsApi = new ApplicationsApi(cfg);\n  const callbacksApi = new CallbacksApi(cfg);\n  const apisApi = new APIsApi(cfg);\n\n  return {\n    usersApi,\n    oauthApi,\n    subscribersApi,\n    organizationsApi,\n    connectedAppsApi,\n    featureFlagsApi,\n    environmentsApi,\n    permissionsApi,\n    rolesApi,\n    businessApi,\n    industriesApi,\n    timezonesApi,\n    applicationsApi,\n    callbacksApi,\n    apisApi\n  };\n};\n","import jwt_decode from 'jwt-decode';\nimport {config} from '../../config/index';\n\nconst isTokenValid = (token) => {\n  const accessToken = (token && token.access_token) || token;\n  if (!accessToken) return false;\n\n  const accessTokenHeader = jwt_decode(accessToken, {header: true});\n  const accessTokenPayload = jwt_decode(accessToken);\n  let isAudienceValid = true;\n  if (config.audience)\n    isAudienceValid =\n      accessTokenPayload.aud &&\n      accessTokenPayload.aud.includes(config.audience);\n\n  if (\n    accessTokenPayload.iss == config.issuerURL &&\n    accessTokenHeader.alg == 'RS256' &&\n    accessTokenPayload.exp > Math.floor(Date.now() / 1000) &&\n    isAudienceValid\n  ) {\n    return true;\n  } else {\n    return false;\n  }\n};\n\nexport {isTokenValid};\n","import {getAccessTokenFactory} from './getAccessToken';\nimport {getBooleanFlagFactory} from './getBooleanFlag';\nimport {getFlagFactory} from './getFlag';\nimport {getIdTokenFactory} from './getIdToken';\nimport {getIntegerFlagFactory} from './getIntegerFlag';\nimport {getOrganizationFactory} from './getOrganization';\nimport {getPermissionFactory} from './getPermission';\nimport {getPermissionsFactory} from './getPermissions';\nimport {getStringFlagFactory} from './getStringFlag';\nimport {getUserFactory} from './getUser';\nimport {getUserOrganizationsFactory} from './getUserOrganizations';\nimport {isAuthenticatedFactory} from './isAuthenticated';\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns\n */\nexport default function (req, res) {\n  return {\n    getAccessToken: getAccessTokenFactory(req, res),\n    getBooleanFlag: getBooleanFlagFactory(req, res),\n    getFlag: getFlagFactory(req, res),\n    getIdToken: getIdTokenFactory(req, res),\n    getIntegerFlag: getIntegerFlagFactory(req, res),\n    getOrganization: getOrganizationFactory(req, res),\n    getPermission: getPermissionFactory(req, res),\n    getPermissions: getPermissionsFactory(req, res),\n    getStringFlag: getStringFlagFactory(req, res),\n    getUser: getUserFactory(req, res),\n    getUserOrganizations: getUserOrganizationsFactory(req, res),\n    isAuthenticated: isAuthenticatedFactory(req, res)\n  };\n}\n"],"names":["isAppRouter","req","Request","cookie","require","sessionManager","res","appRouterSessionManager","cookies","pageRouterSessionManager","cookieStore","getSessionItem","itemKey","item","get","jsonValue","JSON","parse","value","error","setSessionItem","itemValue","set","stringify","removeSessionItem","delete","destroySession","forEach","name","getHeader","Array","isArray","setHeader","filter","startsWith","serialize","path","maxAge","map","getAccessTokenFactory","async","KINDE_SITE_URL","process","env","KINDE_AUTH_API_PATH","NEXT_PUBLIC_KINDE_AUTH_API_PATH","KINDE_POST_LOGIN_REDIRECT_URL","KINDE_POST_LOGIN_URL_REDIRECT_URL","KINDE_POST_LOGOUT_REDIRECT_URL","KINDE_ISSUER_URL","KINDE_CLIENT_ID","KINDE_CLIENT_SECRET","KINDE_AUDIENCE","config","apiPath","initialState","accessToken","idToken","isAuthenticated","isLoading","organization","permissions","user","userOrganiaztions","getAccessToken","getBooleanFlag","getClaim","getFlag","getIdToken","getIntegerFlag","getOrganization","getPermission","getPermissions","getStringFlag","getToken","getUser","getUserOrganizations","SESSION_PREFIX","redirectURL","postLoginRedirectURL","issuerURL","clientID","clientSecret","postLogoutRedirectURL","audience","responseType","scope","codeChallengeMethod","redirectRoutes","callback","issuerRoutes","logout","login","register","token","profile","clientOptions","authDomain","clientId","logoutRedirectURL","frameworkVersion","framework","grantType","GrantType","AUTHORIZATION_CODE","kindeClient","createKindeServerClient","getFlagFactory","code","defaultValue","flagType","message","includes","getBooleanFlagFactory","err","console","getIdTokenFactory","getIntegerFlagFactory","getOrganizationFactory","getPermissionFactory","getPermissionsFactory","getStringFlagFactory","getUserFactory","getUserOrganizationsFactory","isAuthenticatedFactory","Boolean","AppRouterClient","constructor","this","url","URL","searchParams","nextUrl","redirect","getUrl","json","data","status","NextResponse","getSearchParam","key","PagesRouterClient","href","routeMap","create_org","options","org_name","routerClient","is_create_org","authUrl","createOrg","authUrlParams","Object","fromEntries","setup","accessTokenEncoded","getClaimValue","featureFlags","userOrganizations","orgCode","kinde_callback","postLoginRedirectURLFromMemory","handleRedirectToApp","getRoute","endpoint","appRouterHandler","params","kindeAuth","route","Response","pagesRouterHandler","query","end","children","orgName","props","React","createElement","_extends","URLSearchParams","paramsObj","org_code","post_login_redirect_url","append","toString","apiToken","store","tokenFromCookie","access_token","accessTokenHeader","jwt_decode","header","accessTokenPayload","isAudienceValid","aud","iss","alg","exp","Math","floor","Date","now","isTokenValid","response","fetch","method","headers","body","grant_type","client_id","client_secret","cfg","Configuration","basePath","Accept","usersApi","UsersApi","oauthApi","OAuthApi","subscribersApi","SubscribersApi","organizationsApi","OrganizationsApi","connectedAppsApi","ConnectedAppsApi","featureFlagsApi","FeatureFlagsApi","environmentsApi","EnvironmentsApi","permissionsApi","PermissionsApi","rolesApi","RolesApi","businessApi","BusinessApi","industriesApi","IndustriesApi","timezonesApi","TimezonesApi","applicationsApi","ApplicationsApi","callbacksApi","CallbacksApi","apisApi","APIsApi","request"],"mappings":"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"}