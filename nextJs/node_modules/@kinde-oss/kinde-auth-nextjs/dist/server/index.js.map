{"version":3,"file":"index.js","sources":["../../src/utils/isAppRouter.js","../../src/session/sessionManager.js","../../src/session/getAccessToken.js","../../src/config/index.js","../../src/utils/version.js","../../src/session/kindeServerClient.js","../../src/session/getFlag.js","../../src/session/getBooleanFlag.js","../../src/session/getIdToken.js","../../src/session/getIntegerFlag.js","../../src/session/getOrganization.js","../../src/session/getPermission.js","../../src/session/getPermissions.js","../../src/session/getStringFlag.js","../../src/session/getUser.js","../../src/session/getUserOrganizations.js","../../src/session/isAuthenticated.js","../../src/session/index.js","../../src/components/RegisterLink.js","../../src/components/LoginLink.js","../../src/components/LogoutLink.js","../../src/components/CreateOrgLink.js","../../src/utils/pageRouter/isTokenValid.js","../../src/api-client.js","../../src/routerClients/AppRouterClient.js","../../src/routerClients/PagesRouterClient.js","../../src/handlers/auth.js","../../src/handlers/createOrg.js","../../src/handlers/register.js","../../src/handlers/setup.js","../../src/handlers/login.js","../../src/handlers/logout.js","../../src/handlers/callback.js"],"sourcesContent":["export const isAppRouter = (req) => {\n  return req instanceof Request;\n};\n","import {isAppRouter} from '../utils/isAppRouter';\nimport {cookies} from 'next/headers';\n\nvar cookie = require('cookie');\n\n/**\n *\n * @param {Request} [req]\n * @param {Response} [res]\n * @returns\n */\nexport const sessionManager = (req, res) => {\n  if (!req) return appRouterSessionManager(cookies());\n  return isAppRouter(req)\n    ? appRouterSessionManager(cookies())\n    : pageRouterSessionManager(req, res);\n};\n\nexport const appRouterSessionManager = (cookieStore) => ({\n  /**\n   *\n   * @param {string} itemKey\n   * @returns {Promise<string | undefined>}\n   */\n  getSessionItem: (itemKey) => {\n    const item = cookieStore.get(itemKey);\n    if (item) {\n      try {\n        const jsonValue = JSON.parse(item.value);\n        if (typeof jsonValue === 'object') {\n          return jsonValue;\n        }\n        return item.value;\n      } catch (error) {\n        return item.value;\n      }\n    }\n    return undefined;\n  },\n  /**\n   *\n   * @param {string} itemKey\n   * @param {string | object} itemValue\n   * @returns {Promise<void>}\n   */\n  setSessionItem: (itemKey, itemValue) =>\n    cookieStore.set(\n      itemKey,\n      typeof itemValue === 'object' ? JSON.stringify(itemValue) : itemValue\n    ),\n  /**\n   *\n   * @param {string} itemKey\n   * @returns {Promise<void>}\n   */\n  removeSessionItem: (itemKey) => cookieStore.delete(itemKey),\n  destroySession: () => {\n    [\n      'id_token_payload',\n      'id_token',\n      'access_token_payload',\n      'access_token',\n      'user',\n      'refresh_token'\n    ].forEach((name) => cookieStore.delete(name));\n  }\n});\n\nexport const pageRouterSessionManager = (req, res) => ({\n  /**\n   *\n   * @param {string} itemKey\n   * @returns {Promise<string | undefined>}\n   */\n  getSessionItem: (itemKey) => {\n    const itemValue = req.cookies[itemKey];\n    if (itemValue) {\n      try {\n        const jsonValue = JSON.parse(itemValue);\n        if (typeof jsonValue === 'object') {\n          return jsonValue;\n        }\n        return itemValue;\n      } catch (error) {\n        return itemValue;\n      }\n    }\n    return undefined;\n  },\n  /**\n   *\n   * @param {string} itemKey -\n   * @param {string | object} itemValue\n   * @returns {Promise<void>}\n   */\n  setSessionItem: (itemKey, itemValue) => {\n    let cookies = res.getHeader('Set-Cookie') || [];\n\n    if (!Array.isArray(cookies)) {\n      cookies = [cookies];\n    }\n\n    res.setHeader('Set-Cookie', [\n      ...cookies.filter((cookie) => !cookie.startsWith(`${itemKey}=`)),\n      cookie.serialize(\n        itemKey,\n        typeof itemValue === 'object' ? JSON.stringify(itemValue) : itemValue,\n        {path: '/'}\n      )\n    ]);\n  },\n  /**\n   *\n   * @param {string} itemKey\n   * @returns {Promise<void>}\n   */\n  removeSessionItem: (itemKey) => {\n    res.setHeader(\n      'Set-Cookie',\n      cookie.serialize(itemKey, '', {path: '/', maxAge: -1})\n    );\n  },\n  destroySession: () => {\n    res.setHeader(\n      'Set-Cookie',\n      [\n        'id_token_payload',\n        'id_token',\n        'access_token_payload',\n        'access_token',\n        'user',\n        'refresh_token'\n      ].map((name) => cookie.serialize(name, '', {path: '/', maxAge: -1}))\n    );\n  }\n});\n","import {sessionManager} from './sessionManager';\n\n/**\n * @callback getAccessToken\n * @returns {Promise<import('../../types.js').KindeAccessToken | undefined>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n *\n * @returns {getAccessToken}\n */\n// @ts-ignore\nexport const getAccessTokenFactory = (req, res) => async () => {\n  return await sessionManager(req, res).getSessionItem('access_token_payload');\n};\n","import {GrantType} from '@kinde-oss/kinde-typescript-sdk';\nimport {version} from '../utils/version';\n\n/**\n * @type {import('../../types').KindeState}\n */\nconst initialState = {\n  accessToken: null,\n  idToken: null,\n  isAuthenticated: false,\n  isLoading: true,\n  organization: null,\n  permissions: [],\n  user: null,\n  userOrganiaztions: [],\n  getAccessToken: () => null,\n  getBooleanFlag: () => null,\n  getClaim: () => null,\n  getFlag: () => null,\n  getIdToken: () => null,\n  getIntegerFlag: () => null,\n  getOrganization: () => null,\n  getPermission: () => null,\n  getPermissions: () => [],\n  getStringFlag: () => null,\n  getToken: () => null,\n  getUser: () => null,\n  getUserOrganizations: () => null\n};\n\nconst SESSION_PREFIX = 'pkce-verifier';\n\nconst KINDE_SITE_URL = process.env.KINDE_SITE_URL;\n\n// We need to use NEXT_PUBLIC for frontend vars\nconst KINDE_AUTH_API_PATH =\n  process.env.NEXT_PUBLIC_KINDE_AUTH_API_PATH ||\n  process.env.KINDE_AUTH_API_PATH ||\n  '/api/auth';\n\nconst KINDE_POST_LOGIN_REDIRECT_URL =\n  process.env.KINDE_POST_LOGIN_REDIRECT_URL ||\n  process.env.KINDE_POST_LOGIN_URL_REDIRECT_URL;\nconst KINDE_POST_LOGOUT_REDIRECT_URL =\n  process.env.KINDE_POST_LOGOUT_REDIRECT_URL;\n\nconst KINDE_ISSUER_URL = process.env.KINDE_ISSUER_URL;\nconst KINDE_CLIENT_ID = process.env.KINDE_CLIENT_ID;\nconst KINDE_CLIENT_SECRET = process.env.KINDE_CLIENT_SECRET;\nconst KINDE_AUDIENCE = process.env.KINDE_AUDIENCE;\n\nexport const config = {\n  apiPath: KINDE_AUTH_API_PATH,\n  initialState,\n  SESSION_PREFIX,\n  redirectURL: KINDE_SITE_URL,\n  postLoginRedirectURL: KINDE_POST_LOGIN_REDIRECT_URL,\n  issuerURL: KINDE_ISSUER_URL,\n  clientID: KINDE_CLIENT_ID,\n  clientSecret: KINDE_CLIENT_SECRET,\n  postLogoutRedirectURL: KINDE_POST_LOGOUT_REDIRECT_URL,\n  audience: KINDE_AUDIENCE,\n  responseType: 'code',\n  scope: 'openid profile email offline',\n  codeChallengeMethod: 'S256',\n  redirectRoutes: {\n    callback: `${KINDE_AUTH_API_PATH}/kinde_callback`\n  },\n  issuerRoutes: {\n    logout: '/logout',\n    login: '/oauth2/auth',\n    register: '/oauth2/auth',\n    token: '/oauth2/token',\n    profile: '/oauth2/v2/user_profile'\n  },\n  clientOptions: {\n    audience: KINDE_AUDIENCE || '',\n    authDomain: KINDE_ISSUER_URL || '',\n    clientId: KINDE_CLIENT_ID || '',\n    clientSecret: KINDE_CLIENT_SECRET || '',\n    logoutRedirectURL: KINDE_POST_LOGOUT_REDIRECT_URL || '',\n    redirectURL: `${KINDE_SITE_URL}/api/auth/kinde_callback`,\n    frameworkVersion: version,\n    framework: 'Next.js'\n  },\n  grantType: GrantType.AUTHORIZATION_CODE\n};\n","// Generated by genversion.\nexport const version = '2.0.4'\n","import {createKindeServerClient} from '@kinde-oss/kinde-typescript-sdk';\nimport {config} from '../config/index';\n\nexport const kindeClient = createKindeServerClient(\n  config.grantType,\n  config.clientOptions\n);\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getFlag\n * @param {string} code\n * @param {boolean | number | string} defaultValue\n * @param {import('../../types').KindeFlagTypeCode} flagType\n * @returns {Promise<import('../../types').KindeFlag | {value: boolean | number | string}>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getFlag}\n */\nexport const getFlagFactory =\n  (req, res) => async (code, defaultValue, flagType) => {\n    try {\n      const flag = await kindeClient.getFlag(\n        sessionManager(req, res),\n        code,\n        defaultValue,\n        flagType\n      );\n\n      return flag;\n    } catch (error) {\n      //@ts-ignore\n      if (error.message.includes('no default value has been provided')) {\n        throw error;\n      }\n      return {value: defaultValue};\n    }\n  };\n","import {getFlagFactory} from './getFlag';\n\n/**\n * @callback getBooleanFlag\n * @param {string} code\n * @param {boolean} defaultValue\n * @returns {Promise<boolean | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getBooleanFlag}\n */\nexport const getBooleanFlagFactory =\n  (req, res) => async (code, defaultValue) => {\n    try {\n      const flag = await getFlagFactory(req, res)(code, defaultValue, 'b');\n      return flag.value;\n    } catch (err) {\n      console.error(err);\n      return null;\n    }\n  };\n","import {sessionManager} from './sessionManager';\n\n/**\n * @callback getIdToken\n * @returns {Promise<import('../../types').KindeIdToken>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getIdToken}\n */\n\n// @ts-ignore\nexport const getIdTokenFactory = (req, res) => async () => {\n  return await sessionManager(req, res).getSessionItem('id_token_payload');\n};\n","import {getFlagFactory} from './getFlag';\n\n/**\n * @callback getIntegerFlag\n * @param {string} code\n * @param {number} defaultValue\n * @returns {Promise<number | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getIntegerFlag}\n */\nexport const getIntegerFlagFactory =\n  (req, res) => async (code, defaultValue) => {\n    try {\n      const flag = await getFlagFactory(req, res)(code, defaultValue, 'i');\n      return flag.value;\n    } catch (err) {\n      console.error(err);\n      return null;\n    }\n  };\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getOrganization\n * @returns {Promise<import('../../types').KindeOrganization | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getOrganization}\n */\nexport const getOrganizationFactory = (req, res) => async () => {\n  try {\n    const organization = await kindeClient.getOrganization(\n      sessionManager(req, res)\n    );\n    return organization;\n  } catch (error) {\n    return null;\n  }\n};\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getPermission\n *  @param {string} name\n * @returns {Promise<import('../../types').KindePermission | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getPermission}\n */\nexport const getPermissionFactory = (req, res) => async (name) => {\n  try {\n    const permission = await kindeClient.getPermission(\n      sessionManager(req, res),\n      name\n    );\n    return permission;\n  } catch (error) {\n    return null;\n  }\n};\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getPermissions\n * @returns {Promise<import('../../types').KindePermissions | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getPermissions}\n */\nexport const getPermissionsFactory = (req, res) => async () => {\n  try {\n    const permissions = await kindeClient.getPermissions(\n      sessionManager(req, res)\n    );\n    return permissions;\n  } catch (error) {\n    return null;\n  }\n};\n","import {getFlagFactory} from './getFlag';\n\n/**\n * @callback getStringFlag\n * @param {string} code\n * @param {string} defaultValue\n * @returns {Promise<string | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getStringFlag}\n */\nexport const getStringFlagFactory =\n  (req, res) => async (code, defaultValue) => {\n    try {\n      const flag = await getFlagFactory(req, res)(code, defaultValue, 's');\n      return flag.value;\n    } catch (err) {\n      console.error(err);\n      return null;\n    }\n  };\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getUser\n * @returns {Promise<import('../../types').KindeUser | null>}\n */\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getUser}\n */\nexport const getUserFactory = (req, res) => async () => {\n  try {\n    // @ts-ignore\n    const user = await kindeClient.getUser(sessionManager(req, res));\n    return user;\n  } catch (error) {\n    return null;\n  }\n};\n","import {sessionManager} from './sessionManager';\nimport {kindeClient} from './kindeServerClient';\n\n/**\n * @callback getUserOrganizations\n * @returns {Promise<import('../../types').KindeOrganizations | null>}\n */\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {getUserOrganizations}\n */\nexport const getUserOrganizationsFactory = (req, res) => async () => {\n  try {\n    const userOrgs = await kindeClient.getUserOrganizations(\n      sessionManager(req, res)\n    );\n    return userOrgs;\n  } catch (error) {\n    return null;\n  }\n};\n","import {getUserFactory} from './getUser';\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns {() => Promise<boolean>}\n */\nexport const isAuthenticatedFactory = (req, res) => async () => {\n  const user = await getUserFactory(req, res)();\n  return Boolean(user);\n};\n","import {getAccessTokenFactory} from './getAccessToken';\nimport {getBooleanFlagFactory} from './getBooleanFlag';\nimport {getFlagFactory} from './getFlag';\nimport {getIdTokenFactory} from './getIdToken';\nimport {getIntegerFlagFactory} from './getIntegerFlag';\nimport {getOrganizationFactory} from './getOrganization';\nimport {getPermissionFactory} from './getPermission';\nimport {getPermissionsFactory} from './getPermissions';\nimport {getStringFlagFactory} from './getStringFlag';\nimport {getUserFactory} from './getUser';\nimport {getUserOrganizationsFactory} from './getUserOrganizations';\nimport {isAuthenticatedFactory} from './isAuthenticated';\n\n/**\n *\n * @param {import('next').NextApiRequest} [req]\n * @param {import('next').NextApiResponse} [res]\n * @returns\n */\nexport default function (req, res) {\n  return {\n    getAccessToken: getAccessTokenFactory(req, res),\n    getBooleanFlag: getBooleanFlagFactory(req, res),\n    getFlag: getFlagFactory(req, res),\n    getIdToken: getIdTokenFactory(req, res),\n    getIntegerFlag: getIntegerFlagFactory(req, res),\n    getOrganization: getOrganizationFactory(req, res),\n    getPermission: getPermissionFactory(req, res),\n    getPermissions: getPermissionsFactory(req, res),\n    getStringFlag: getStringFlagFactory(req, res),\n    getUser: getUserFactory(req, res),\n    getUserOrganizations: getUserOrganizationsFactory(req, res),\n    isAuthenticated: isAuthenticatedFactory(req, res)\n  };\n}\n","import React from 'react';\nimport {config} from '../config/index';\n\n/**\n * @typedef {Object} PropsType\n * @prop {React.ReactNode} children\n * @prop {string} [orgCode]\n * @prop {string} [postLoginRedirectURL]\n * @prop {Object.<string, string>} [authUrlParams]\n *\n * @typedef {PropsType & React.AnchorHTMLAttributes<HTMLAnchorElement>} Props\n */\n\n/**\n * @param {Props} props\n */\n\nexport function RegisterLink({\n  children,\n  orgCode,\n  postLoginRedirectURL,\n  authUrlParams,\n  ...props\n}) {\n  let params = new URLSearchParams();\n  let paramsObj = {};\n  if (orgCode != null) paramsObj.org_code = orgCode;\n  if (postLoginRedirectURL != null)\n    paramsObj.post_login_redirect_url = postLoginRedirectURL;\n\n  paramsObj = {...authUrlParams, ...paramsObj};\n\n  for (const key in paramsObj) params.append(key, paramsObj[key]);\n  return (\n    <a\n      href={`${config.apiPath}/register${\n        params ? `?${params.toString()}` : ''\n      }`}\n      {...props}\n    >\n      {children}\n    </a>\n  );\n}\n","import React from 'react';\nimport {config} from '../config/index';\n\n/**\n * @typedef {Object} PropsType\n * @prop {React.ReactNode} children\n * @prop {string} [orgCode]\n * @prop {string} [postLoginRedirectURL]\n * @prop {Object.<string, string>} [authUrlParams]\n *\n * @typedef {PropsType & React.AnchorHTMLAttributes<HTMLAnchorElement>} Props\n */\n\n/**\n * @param {Props} props\n */\nexport function LoginLink({\n  children,\n  postLoginRedirectURL,\n  orgCode,\n  authUrlParams,\n  ...props\n}) {\n  let params = new URLSearchParams();\n  let paramsObj = {};\n  if (orgCode != null) paramsObj.org_code = orgCode;\n  if (postLoginRedirectURL != null)\n    paramsObj.post_login_redirect_url = postLoginRedirectURL;\n\n  paramsObj = {...authUrlParams, ...paramsObj};\n\n  for (const key in paramsObj) params.append(key, paramsObj[key]);\n\n  return (\n    <a\n      href={`${config.apiPath}/login${params ? `?${params.toString()}` : ''}`}\n      {...props}\n    >\n      {children}\n    </a>\n  );\n}\n","import React from 'react';\n\nimport {config} from '../config/index';\n/**\n * @typedef {Object} PropsType\n * @prop {React.ReactNode} children\n *\n * @typedef {PropsType & React.AnchorHTMLAttributes<HTMLAnchorElement>} Props\n */\n\n/**\n * @param {Props} props\n */\nexport function LogoutLink({children, ...props}) {\n  return (\n    <a href={`${config.apiPath}/logout`} {...props}>\n      {children}\n    </a>\n  );\n}\n","import React from 'react';\n\nimport {config} from '../config/index';\n/**\n * @typedef {Object} PropsType\n * @prop {React.ReactNode} children\n * @prop {string} [orgName]\n *\n * @typedef {PropsType & React.AnchorHTMLAttributes<HTMLAnchorElement>} Props\n */\n\n/**\n * @param {Props} props\n */\nexport function CreateOrgLink({children, orgName, ...props}) {\n  return (\n    <a\n      href={`${config.apiPath}/create_org${\n        orgName ? `?org_name=${orgName}` : ''\n      }`}\n      {...props}\n    >\n      {children}\n    </a>\n  );\n}\n","import jwt_decode from 'jwt-decode';\nimport {config} from '../../config/index';\n\nconst isTokenValid = (token) => {\n  const accessToken = (token && token.access_token) || token;\n  if (!accessToken) return false;\n\n  const accessTokenHeader = jwt_decode(accessToken, {header: true});\n  const accessTokenPayload = jwt_decode(accessToken);\n  let isAudienceValid = true;\n  if (config.audience)\n    isAudienceValid =\n      accessTokenPayload.aud &&\n      accessTokenPayload.aud.includes(config.audience);\n\n  if (\n    accessTokenPayload.iss == config.issuerURL &&\n    accessTokenHeader.alg == 'RS256' &&\n    accessTokenPayload.exp > Math.floor(Date.now() / 1000) &&\n    isAudienceValid\n  ) {\n    return true;\n  } else {\n    return false;\n  }\n};\n\nexport {isTokenValid};\n","import {\n  APIsApi,\n  ApplicationsApi,\n  BusinessApi,\n  CallbacksApi,\n  Configuration,\n  ConnectedAppsApi,\n  EnvironmentsApi,\n  FeatureFlagsApi,\n  IndustriesApi,\n  OAuthApi,\n  OrganizationsApi,\n  PermissionsApi,\n  RolesApi,\n  SubscribersApi,\n  TimezonesApi,\n  UsersApi\n} from '@kinde-oss/kinde-typescript-sdk';\nimport {config} from './config/index';\nimport {sessionManager} from './session/sessionManager';\nimport {isTokenValid} from './utils/pageRouter/isTokenValid';\n\n/**\n * Create the Kinde Management API client\n * @param {Request | NextApiRequest} [req] - optional request (required when used with pages router)\n * @param {Response | NextApiResponse} [res] - optional response (required when used with pages router)\n */\nexport const createKindeManagementAPIClient = async (req, res) => {\n  let apiToken = null;\n\n  const store = sessionManager(req, res);\n  const tokenFromCookie = store.getSessionItem('kinde_api_access_token');\n\n  if (isTokenValid(tokenFromCookie)) {\n    apiToken = tokenFromCookie;\n  } else {\n    const response = await fetch(`${config.issuerURL}/oauth2/token`, {\n      method: 'POST',\n      headers: {\n        'content-type': 'application/x-www-form-urlencoded'\n      },\n      body: new URLSearchParams({\n        grant_type: 'client_credentials',\n        client_id: config.clientID,\n        client_secret: config.clientSecret,\n        audience: config.audience\n      })\n    });\n    apiToken = (await response.json()).access_token;\n    try {\n      store.setSessionItem('kinde_api_access_token', apiToken);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  const cfg = new Configuration({\n    basePath: config.issuerURL,\n    accessToken: apiToken,\n    headers: {Accept: 'application/json'}\n  });\n\n  const usersApi = new UsersApi(cfg);\n  const oauthApi = new OAuthApi(cfg);\n  const subscribersApi = new SubscribersApi(cfg);\n  const organizationsApi = new OrganizationsApi(cfg);\n  const connectedAppsApi = new ConnectedAppsApi(cfg);\n  const featureFlagsApi = new FeatureFlagsApi(cfg);\n  const environmentsApi = new EnvironmentsApi(cfg);\n  const permissionsApi = new PermissionsApi(cfg);\n  const rolesApi = new RolesApi(cfg);\n  const businessApi = new BusinessApi(cfg);\n  const industriesApi = new IndustriesApi(cfg);\n  const timezonesApi = new TimezonesApi(cfg);\n  const applicationsApi = new ApplicationsApi(cfg);\n  const callbacksApi = new CallbacksApi(cfg);\n  const apisApi = new APIsApi(cfg);\n\n  return {\n    usersApi,\n    oauthApi,\n    subscribersApi,\n    organizationsApi,\n    connectedAppsApi,\n    featureFlagsApi,\n    environmentsApi,\n    permissionsApi,\n    rolesApi,\n    businessApi,\n    industriesApi,\n    timezonesApi,\n    applicationsApi,\n    callbacksApi,\n    apisApi\n  };\n};\n","import {createKindeServerClient} from '@kinde-oss/kinde-typescript-sdk';\nimport {cookies} from 'next/headers';\nimport {redirect} from 'next/navigation';\nimport {NextResponse} from 'next/server';\nimport {config} from '../config/index';\nimport {appRouterSessionManager} from '../session/sessionManager';\n\nexport default class AppRouterClient {\n  constructor(req, res) {\n    this.kindeClient = createKindeServerClient(\n      config.grantType,\n      config.clientOptions\n    );\n    this.url = new URL(req.url);\n    this.sessionManager = appRouterSessionManager(cookies());\n    this.req = req;\n    this.searchParams = req.nextUrl.searchParams;\n  }\n\n  redirect(url) {\n    return redirect(url);\n  }\n\n  getUrl() {\n    return this.url;\n  }\n\n  json(data, status) {\n    return NextResponse.json(data, status);\n  }\n\n  error() {\n    return NextResponse.error;\n  }\n\n  getSearchParam(key) {\n    return this.req.nextUrl.searchParams.get(key);\n  }\n}\n","import {createKindeServerClient} from '@kinde-oss/kinde-typescript-sdk';\nimport {config} from '../config/index';\nimport {sessionManager} from '../session/sessionManager';\n\nexport default class PagesRouterClient {\n  constructor(req, res) {\n    this.kindeClient = createKindeServerClient(\n      config.grantType,\n      config.clientOptions\n    );\n    this.url = new URL(config.redirectURL + req.url);\n    this.res = res;\n    this.req = req;\n    this.searchParams = this.url.searchParams;\n    this.sessionManager = sessionManager(req, res);\n  }\n\n  redirect(url) {\n    return this.res.redirect(url.href ? url.href : url);\n  }\n\n  getUrl() {\n    return this.url;\n  }\n\n  json(data, status = 200) {\n    return this.res.status(status).json(data);\n  }\n\n  getSearchParam(key) {\n    return this.url.searchParams.get(key);\n  }\n}\n","import {isAppRouter} from '../utils/isAppRouter';\nimport {callback} from './callback';\nimport {createOrg} from './createOrg';\nimport {login} from './login';\nimport {logout} from './logout';\nimport {setup} from './setup';\nimport {register} from './register';\nimport AppRouterClient from '../routerClients/AppRouterClient';\nimport PagesRouterClient from '../routerClients/PagesRouterClient';\n\nconst routeMap = {\n  create_org: createOrg,\n  register,\n  setup,\n  login,\n  logout,\n  kinde_callback: callback\n};\n\nconst getRoute = (endpoint) => {\n  return routeMap[endpoint];\n};\n/**\n * @param {object} [request]\n * @param {string} [endpoint]\n */\nexport default (request, endpoint) => {\n  // For backwards compatibility in app router\n  if (typeof request == 'object' && typeof endpoint == 'string') {\n    return appRouterHandler(request, {params: {kindeAuth: endpoint}});\n  }\n  /**\n   *\n   * @param {Request} [req]\n   * @param {Response} [res]\n   * @returns {Response}\n   */\n  return async function handler(req, res) {\n    return isAppRouter(req)\n      ? appRouterHandler(req, res)\n      : pagesRouterHandler(req, res);\n  };\n};\n\nconst appRouterHandler = async (req, res) => {\n  const {params} = res;\n  let endpoint = params.kindeAuth;\n  endpoint = Array.isArray(endpoint) ? endpoint[0] : endpoint;\n  const route = getRoute(endpoint);\n\n  return route\n    ? await route(new AppRouterClient(req, res))\n    : new Response('This page could not be found.', {status: 404});\n};\n\nconst pagesRouterHandler = async (req, res) => {\n  let {\n    query: {kindeAuth: endpoint}\n  } = req;\n  endpoint = Array.isArray(endpoint) ? endpoint[0] : endpoint;\n  const route = getRoute(endpoint);\n  return route\n    ? await route(new PagesRouterClient(req, res))\n    : res.status(404).end();\n};\n","export const createOrg = async (routerClient) => {\n  const org_name = routerClient.getSearchParam('org_name');\n  const options = {\n    org_name,\n    is_create_org: true\n  };\n\n  const authUrl = await routerClient.kindeClient.createOrg(\n    routerClient.sessionManager,\n    options\n  );\n\n  routerClient.redirect(authUrl);\n};\n","export const register = async (routerClient) => {\n  const authUrl = await routerClient.kindeClient.register(\n    routerClient.sessionManager,\n    {\n      authUrlParams: Object.fromEntries(routerClient.searchParams)\n    }\n  );\n\n  const postLoginRedirectURL = routerClient.getSearchParam(\n    'post_login_redirect_url'\n  );\n\n  if (postLoginRedirectURL) {\n    await routerClient.sessionManager.setSessionItem(\n      'post_login_redirect_url',\n      postLoginRedirectURL\n    );\n  }\n\n  routerClient.redirect(authUrl);\n};\n","export const setup = async (routerClient) => {\n  const user = await routerClient.sessionManager.getSessionItem('user');\n  if (user) {\n    const accessToken = await routerClient.sessionManager.getSessionItem(\n      'access_token_payload'\n    );\n\n    const idToken = await routerClient.sessionManager.getSessionItem(\n      'id_token_payload'\n    );\n\n    const accessTokenEncoded = await routerClient.sessionManager.getSessionItem(\n      'access_token'\n    );\n\n    const permissions = await routerClient.kindeClient.getClaimValue(\n      routerClient.sessionManager,\n      'permissions'\n    );\n\n    const organization = await routerClient.kindeClient.getClaimValue(\n      routerClient.sessionManager,\n      'org_code'\n    );\n\n    const featureFlags = await routerClient.kindeClient.getClaimValue(\n      routerClient.sessionManager,\n      'feature_flags'\n    );\n\n    const userOrganizations = await routerClient.kindeClient.getClaimValue(\n      routerClient.sessionManager,\n      'org_codes',\n      'id_token'\n    );\n\n    return routerClient.json({\n      accessToken,\n      accessTokenEncoded,\n      idToken,\n      user,\n      permissions: {\n        permissions,\n        orgCode: organization\n      },\n      organization,\n      featureFlags,\n      userOrganizations\n    });\n  } else {\n    return routerClient.json({error: 'Log in with Kinde'}, {status: 401});\n  }\n};\n","export const login = async (routerClient) => {\n  const authUrl = await routerClient.kindeClient.login(\n    routerClient.sessionManager,\n    {\n      authUrlParams: Object.fromEntries(routerClient.searchParams)\n    }\n  );\n\n  const postLoginRedirectURL = routerClient.getSearchParam(\n    'post_login_redirect_url'\n  );\n\n  if (postLoginRedirectURL) {\n    await routerClient.sessionManager.setSessionItem(\n      'post_login_redirect_url',\n      postLoginRedirectURL\n    );\n  }\n\n  routerClient.redirect(authUrl);\n};\n","export const logout = async (routerClient) => {\n  const authUrl = await routerClient.kindeClient.logout(\n    routerClient.sessionManager\n  );\n\n  routerClient.redirect(authUrl);\n};\n","import {config} from '../config/index';\n\nexport const callback = async (routerClient) => {\n  const postLoginRedirectURLFromMemory =\n    await routerClient.sessionManager.getSessionItem('post_login_redirect_url');\n\n  if (postLoginRedirectURLFromMemory) {\n    await routerClient.sessionManager.removeSessionItem(\n      'post_login_redirect_url'\n    );\n  }\n\n  const postLoginRedirectURL = postLoginRedirectURLFromMemory\n    ? postLoginRedirectURLFromMemory\n    : config.postLoginRedirectURL;\n\n  await routerClient.kindeClient.handleRedirectToApp(\n    routerClient.sessionManager,\n    routerClient.getUrl()\n  );\n\n  routerClient.redirect(postLoginRedirectURL);\n};\n"],"names":["isAppRouter","req","Request","cookie","require","sessionManager","res","appRouterSessionManager","cookies","pageRouterSessionManager","cookieStore","getSessionItem","itemKey","item","get","jsonValue","JSON","parse","value","error","setSessionItem","itemValue","set","stringify","removeSessionItem","delete","destroySession","forEach","name","getHeader","Array","isArray","setHeader","filter","startsWith","serialize","path","maxAge","map","getAccessTokenFactory","async","KINDE_SITE_URL","process","env","KINDE_AUTH_API_PATH","NEXT_PUBLIC_KINDE_AUTH_API_PATH","KINDE_POST_LOGIN_REDIRECT_URL","KINDE_POST_LOGIN_URL_REDIRECT_URL","KINDE_POST_LOGOUT_REDIRECT_URL","KINDE_ISSUER_URL","KINDE_CLIENT_ID","KINDE_CLIENT_SECRET","KINDE_AUDIENCE","config","apiPath","initialState","accessToken","idToken","isAuthenticated","isLoading","organization","permissions","user","userOrganiaztions","getAccessToken","getBooleanFlag","getClaim","getFlag","getIdToken","getIntegerFlag","getOrganization","getPermission","getPermissions","getStringFlag","getToken","getUser","getUserOrganizations","SESSION_PREFIX","redirectURL","postLoginRedirectURL","issuerURL","clientID","clientSecret","postLogoutRedirectURL","audience","responseType","scope","codeChallengeMethod","redirectRoutes","callback","issuerRoutes","logout","login","register","token","profile","clientOptions","authDomain","clientId","logoutRedirectURL","frameworkVersion","framework","grantType","GrantType","AUTHORIZATION_CODE","kindeClient","createKindeServerClient","getFlagFactory","code","defaultValue","flagType","message","includes","getBooleanFlagFactory","err","console","getIdTokenFactory","getIntegerFlagFactory","getOrganizationFactory","getPermissionFactory","getPermissionsFactory","getStringFlagFactory","getUserFactory","getUserOrganizationsFactory","isAuthenticatedFactory","Boolean","index","RegisterLink","children","orgCode","authUrlParams","props","params","URLSearchParams","paramsObj","org_code","post_login_redirect_url","key","append","React","createElement","_extends","href","toString","LoginLink","LogoutLink","CreateOrgLink","orgName","createKindeManagementAPIClient","apiToken","store","tokenFromCookie","access_token","accessTokenHeader","jwt_decode","header","accessTokenPayload","isAudienceValid","aud","iss","alg","exp","Math","floor","Date","now","isTokenValid","response","fetch","method","headers","body","grant_type","client_id","client_secret","json","cfg","Configuration","basePath","Accept","usersApi","UsersApi","oauthApi","OAuthApi","subscribersApi","SubscribersApi","organizationsApi","OrganizationsApi","connectedAppsApi","ConnectedAppsApi","featureFlagsApi","FeatureFlagsApi","environmentsApi","EnvironmentsApi","permissionsApi","PermissionsApi","rolesApi","RolesApi","businessApi","BusinessApi","industriesApi","IndustriesApi","timezonesApi","TimezonesApi","applicationsApi","ApplicationsApi","callbacksApi","CallbacksApi","apisApi","APIsApi","AppRouterClient","constructor","this","url","URL","searchParams","nextUrl","redirect","getUrl","data","status","NextResponse","getSearchParam","PagesRouterClient","routeMap","create_org","options","org_name","routerClient","is_create_org","authUrl","createOrg","Object","fromEntries","setup","accessTokenEncoded","getClaimValue","featureFlags","userOrganizations","kinde_callback","postLoginRedirectURLFromMemory","handleRedirectToApp","getRoute","endpoint","auth","request","appRouterHandler","kindeAuth","pagesRouterHandler","route","Response","query","end"],"mappings":"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"}